--- START OF FILE edit_log.html ---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Cooking Log - KitchenLog</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .edit-log-container { max-width: 700px; margin: 30px auto; }
        /* Star rating styles from cooking_session.html for consistency */
        .rating-stars label { cursor: pointer; font-size: 1.8rem; color: #ccc; transition: color 0.2s; }
        .rating-stars input[type="radio"] { display: none; }
        .rating-stars input[type="radio"]:checked ~ label { color: #ffc107; } /* Gold for checked */
        .rating-stars label:hover,
        .rating-stars label:hover ~ label { color: #ffca2c; } /* Lighter gold for hover */
        .rating-stars { display: inline-block; direction: rtl; } /* Right-to-left for star filling */
        .rating-stars label { float: right; } /* Float labels to make them appear in LTR */
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-edit"></i> Edit Cooking Log</h1>
             <nav class="user-auth-nav" style="margin-top: 15px; text-align: center;">
                <a href="{{ url_for('main.view_logs') }}" class="btn btn-secondary btn-sm">
                    <i class="fas fa-arrow-left"></i> Back to Logs
                </a>
            </nav>
        </div>
    </header>

    <div class="container edit-log-container">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages" style="margin-bottom: 20px;">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="card">
            {% if log_entry and log_entry.recipe_logged %}
                <h2 style="border-bottom:none; margin-bottom: 5px; font-size: 1.5rem;">Recipe: {{ log_entry.recipe_logged.name }}</h2>
                <p style="color: var(--grey); margin-bottom: 25px; font-size:0.9em;">
                    You are editing this cooking log.
                </p>
            {% elif log_entry and not log_entry.recipe_logged %}
                 <h2 style="border-bottom:none; margin-bottom: 5px; font-size: 1.5rem;">Recipe: <em>Deleted Recipe</em></h2>
                 <p style="color: var(--grey); margin-bottom: 25px; font-size:0.9em;">
                    You are editing this cooking log. The original recipe was deleted.
                </p>
            {% else %}
                 <p>Error: Log entry not found.</p>
            {% endif %}

            {% if log_entry %}
            <form method="POST" action="{{ url_for('main.edit_log', log_id=log_entry.id) }}">
                {# Flask-WTF CSRF protection works globally if enabled, so this should be available #}
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <div class="form-group">
                    <label for="date_cooked" class="form-label">Date Cooked</label>
                    <input type="date" class="form-control" id="date_cooked" name="date_cooked" 
                           value="{{ log_entry.date_cooked.isoformat() if log_entry.date_cooked else '' }}" required>
                </div>

                <div class="form-group">
                    <label for="duration_minutes" class="form-label">Duration (minutes)</label>
                    <input type="number" class="form-control" id="duration_minutes" name="duration_minutes" 
                           value="{{ (log_entry.duration_seconds // 60) if log_entry.duration_seconds is not none else '' }}" 
                           min="0" placeholder="Optional (e.g., 30)">
                </div>

                <div class="form-group">
                    <label for="rating" class="form-label">Rating (Optional)</label>
                    <div class="rating-stars">
                        {# Iterate in reverse to ensure correct checked state and hover behavior with RTL #}
                        <input type="radio" id="star5" name="rating" value="5" {% if log_entry.rating == 5 %}checked{% endif %} /><label for="star5" title="5 stars">★</label>
                        <input type="radio" id="star4" name="rating" value="4" {% if log_entry.rating == 4 %}checked{% endif %} /><label for="star4" title="4 stars">★</label>
                        <input type="radio" id="star3" name="rating" value="3" {% if log_entry.rating == 3 %}checked{% endif %} /><label for="star3" title="3 stars">★</label>
                        <input type="radio" id="star2" name="rating" value="2" {% if log_entry.rating == 2 %}checked{% endif %} /><label for="star2" title="2 stars">★</label>
                        <input type="radio" id="star1" name="rating" value="1" {% if log_entry.rating == 1 %}checked{% endif %} /><label for="star1" title="1 star">★</label>
                    </div>
                    <button type="button" id="clear-rating" class="btn btn-sm btn-outline-secondary" style="margin-left: 10px; vertical-align: middle; font-size:0.8em; padding: 3px 8px;" title="Clear Rating">Clear</button>
                </div>

                <div class="form-group">
                    <label for="notes" class="form-label">Session Notes (Optional)</label>
                    <textarea class="form-control" id="notes" name="notes" rows="4" placeholder="e.g., Substituted chicken for tofu...">{{ log_entry.notes or '' }}</textarea>
                </div>

                <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save Changes</button>
                <a href="{{ url_for('main.view_logs') }}" class="btn btn-secondary" style="margin-left: 10px;">Cancel</a>
            </form>
            {% endif %}
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const clearRatingBtn = document.getElementById('clear-rating');
            if (clearRatingBtn) {
                clearRatingBtn.addEventListener('click', function() {
                    const ratingInputs = document.querySelectorAll('input[name="rating"]');
                    ratingInputs.forEach(input => input.checked = false);
                });
            }
        });
    </script>
</body>
</html>
--- END OF FILE edit_log.html ---